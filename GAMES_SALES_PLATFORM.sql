IF DB_ID('GAMES_SALES_PLATFORM') IS NOT NULL
	BEGIN
		ALTER DATABASE [GAMES_SALES_PLATFORM] SET SINGLE_USER WITH ROLLBACK IMMEDIATE
		USE master
		DROP DATABASE GAMES_SALES_PLATFORM
	END
GO

CREATE DATABASE GAMES_SALES_PLATFORM
	ON PRIMARY	(
					NAME = 'GAMES_SALES_PLATFORM_DB',
					FILENAME = 'C:\database\GAMES_SALES_PLATFORM.mdf',
					SIZE = 5MB,
					MAXSIZE = 100MB,
					FILEGROWTH = 5MB
				)
	LOG ON		(
					NAME = 'GAMES_SALES_PLATFORM_DB_LOG',
					FILENAME = 'C:\database\GAMES_SALES_PLATFORM.ldf',
					SIZE = 2MB,
					MAXSIZE = 50MB,
					FILEGROWTH = 1MB
				)
GO

USE GAMES_SALES_PLATFORM

CREATE TABLE ANAHTAR /* 'KEY' YAZILMIYOR */
(
	ANAHTAR_ID INT NOT NULL PRIMARY KEY,
	FIYAT SMALLMONEY, /* -214,748.3648 - 214,748.3647 ARASINDA DEÐER ALIR. */
	TARIH DATE NOT NULL DEFAULT GETDATE() /* CURDATE(), O ANKÝ ZAMANI ALIR. */
)
GO

CREATE TABLE ODULLER 
(
	ODUL_ID INT NOT NULL PRIMARY KEY,
	ODUL_ADI VARCHAR(20),
	TARIH DATE
)
GO

CREATE TABLE OYUN 
(
	OYUN_ID INT NOT NULL PRIMARY KEY,
	OYUN_ADI VARCHAR(20),
	ANAHTAR_ID INT FOREIGN KEY REFERENCES ANAHTAR(ANAHTAR_ID),
	ODUL_ID INT FOREIGN KEY REFERENCES ODULLER(ODUL_ID)
)
GO

CREATE TABLE FATURA 
(
	FATURA_NO INT NOT NULL PRIMARY KEY,
	TUTAR SMALLMONEY,
	TARIH DATE NOT NULL DEFAULT GETDATE(),
)
GO

CREATE TABLE KULLANICI
(
	KULLANICI_ID INT NOT NULL PRIMARY KEY,
	KULLANICI_ADI VARCHAR(20),
	E_MAIL VARCHAR(50),
	ANAHTAR_ID INT FOREIGN KEY REFERENCES ANAHTAR(ANAHTAR_ID),
	FATURA_NO INT FOREIGN KEY REFERENCES FATURA(FATURA_NO)
)
GO

CREATE TABLE ODEME_TURU 
(
	ODEME_ID INT NOT NULL PRIMARY KEY,
	ODEME_ADI VARCHAR(20)
)
GO

CREATE TABLE TAHSILAT 
(
	TAHSILAT_ID INT NOT NULL PRIMARY KEY,
	KULLANICI_ADI VARCHAR(20),
	/* BU ÜÇÜ OPSÝYONEL OLMALI */
	KART_NO INT,
	SON_KULLANMA_T DATE,
	GUVENLIK_KODU INT
	/* BU ÜÇÜ OPSÝYONEL OLMALI */

)
GO

CREATE TABLE BASARIMLAR 
(
	BASARIM_ID INT NOT NULL PRIMARY KEY,
	BASARIM_ADI VARCHAR(20)
)
GO

CREATE TABLE BUNDLE
(
	BUNDLE_ID INT NOT NULL PRIMARY KEY,
	BUNDLE_ADI VARCHAR(50),
	FIYAT SMALLMONEY,
	OYUN_ID INT FOREIGN KEY REFERENCES OYUN(OYUN_ID)
)
GO

CREATE TABLE KATEGORILER 
(
	KATEGORI_ID INT NOT NULL PRIMARY KEY,
	TUR_ADI VARCHAR(20)
)
GO

CREATE TABLE YAPIMCI 
(
	YAPIMCI_ID INT NOT NULL PRIMARY KEY,
	YAPIMCI_ADI VARCHAR(20),
	KURULUS_TARIHI DATE,
	E_MAIL VARCHAR(50),
	WEBSITE VARCHAR(50),
	OYUN_ID INT FOREIGN KEY REFERENCES OYUN(OYUN_ID)
)
GO

CREATE TABLE YAYIMCI 
(
	YAYIMCI_ID INT NOT NULL PRIMARY KEY,
	YAYIMCI_ADI VARCHAR(20),
	E_MAIL VARCHAR(50),
	KURULUS_TARIHI DATE,
	WEBSITE VARCHAR(50),
	OYUN_ID INT FOREIGN KEY REFERENCES OYUN(OYUN_ID)
)
GO

/* GECICI ARA TABLOLAR */

CREATE TABLE #KULLANICI_BASARIM
(
	KULLANICI_ID INT FOREIGN KEY REFERENCES KULLANICI(KULLANICI_ID),
	BASARIM_ID INT FOREIGN KEY REFERENCES BASARIM(BASARIM_ID)
)
GO

CREATE TABLE #OYUN_KATEGORI
(
	OYUN_ID INT FOREIGN KEY REFERENCES OYUN(OYUN_ID),
	KATEGORI_ID INT FOREIGN KEY REFERENCES KATEGORI(KATEGORI_ID)
)
GO

CREATE TABLE #KULLANICI_OYUN
(
	YORUM_ID INT NOT NULL PRIMARY KEY,
	KULLANICI_ID INT FOREIGN KEY REFERENCES KULLANICI(KULLANICI_ID),
	OYUN_ID INT FOREIGN KEY REFERENCES OYUN(OYUN_ID),
	METIN VARCHAR(500),
	BEGENME INT,
	BEGENMEME INT,
)
GO